import esbuild from 'esbuild';
import {execSync} from "child_process";
import fs from "fs";

execSync('tsc');

// @ts-ignore
const pkg = JSON.parse(fs.readFileSync(new URL('./package.json', import.meta.url)).toString());

esbuild.build({
    bundle: true,
    minify: false, // never set to true, because it breaks the method 'printAvailableAutomationActions' in useAutomation.ts
    platform: 'node',
    format: 'cjs',
    target: 'node16',
    outfile: "dist/index.cjs",
    entryPoints: ["src/index.ts"],
    external: [
        ...Object.keys(pkg.dependencies),
        ...Object.keys(pkg.peerDependencies || {})
    ],
    loader: {'.txt': 'text'},
}).then(() => {
    const bytes = fs.statSync('./dist/index.cjs').size;
    console.log(`Build completed. Output file size: ${Math.round(bytes / 1024)} KB`);
})
    .catch(() => process.exit(1));

